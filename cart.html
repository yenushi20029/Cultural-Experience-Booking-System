<!DOCTYPE html>
<html>
    <head>
        <title>Page Title</title>
        <link rel="stylesheet" href="boxicons.min.css">
        <link rel='stylesheet' type='text/css' media='screen' href='Styles.css'>
        <script src='main.js'></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
        <style>

*{
    margin:0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Poppins", sans-serif;
}
        body{
            font-family: Poppins;
            margin: 0;
            background-color: #597E52;
            color: #000000;
        }
                
        header{
            z-index:999;
            position: absolute;
            top:0;
            left:0;
            width:100%;

            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 200px;
            transition: 0.5s ease;
        }

        header .brand{
            color:white;
            font-size: 1.5em;
            font-weight: 700;
            text-transform: uppercase;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap:8px;
            white-space: nowrap;
            font-family: 'Arial', sans-serif;
        }

        header .brand i {
            font-size: 1.5em; 
            color: #C6A969; 
        }

        .navigation {
            display: flex;
            gap: 20px;
            flex-grow: 2; 
            justify-content: flex-end; 
        }

        .brand {
            font-size: 1.8em;
            font-weight: bold;
            flex-grow: 1; 
            color: white; 
        }
.modal {
    display: none;
    position: fixed;
    z-index: 999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5); 
}

.modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 30px;
    border-radius: 12px;
    max-width: 500px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.close-modal {
    float: right;
    font-size: 24px;
    font-weight: bold;
    color: #aaa;
    cursor: pointer;
}
.close-modal:hover {
    color: #e74c3c;
}

#edit-cart-form label {
    display: block;
    margin-top: 15px;
    margin-bottom: 6px;
    font-weight: 600;
    color: #333;
}
#edit-cart-form input[type="number"] {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 16px;
}

#edit-extras-list {
    margin-top: 10px;
}
#edit-extras-list label {
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
}

#edit-cart-form .btnr1 {
    margin-top: 20px;
    padding: 12px;
    width: 100%;
    background-color: #5C7C57;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.2s ease-in-out;
}
#edit-cart-form .btnr1:hover {
    background-color: #5C7C57;
}


        header .navigation{
            display: flex;
            align-items: center;
            width: 100%;

        }
        header .navigation .navigation-items {
            display: flex;
            align-items: center;
        }

        header .navigation .navigation-items a{
            position: relative;
            color: white;
            font-size: 1em;
            font-weight: 500;
            text-decoration: none;
            margin-left: 30px;
            transition: 0.3s ease ;

        }

        header .navigation .navigation-items a:before{
            content:'';
            position: absolute;
            background: white;
            width:0;
            height: 3px;
            bottom: 0;
            left:0;
            transition: 0.3s ease;
        }

        header .navigation .navigation-items a:hover:before{
            width:100%; 
        }

        .search-container {
        display: flex;
        align-items: center;
        position: relative;
        margin-left: 50px;
        margin-right: 70px; 
        
        }

        .search-container i {
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 5px;
        color: white;
        }

        /* Hide the search input by default */
        .search-bar {
        width: 0;
        opacity: 0;
        padding: 5px;
        margin-left: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        transition: all 0.4s ease;
        font-size: 14px;
        background-color: white;
        position: absolute;
        left: 30px;
        top: 50%;
        transform: translateY(-50%);
        }

        /* Expand on hover */
        .search-container:hover .search-bar {
        width: 160px;
        opacity: 1;
        position: relative;
        transform: translateY(0);
        }
        .btn-group {
            display: flex;
            gap: 15px; /* Spacing between the two buttons */
        }

        .btn-group {
            margin-left: auto; /* Pushes this container to the far right */
            display: flex;
            gap: 15px;
        }



        .btn {
            padding: 10px 15px;
            background-color:black;
            color: white;
            border: none;
            border-radius: 25px;
            margin-left: 5px;
            cursor: pointer;
            opacity: 60%;
        }

        .btn:hover {
            background-color: #C6A969;
        }
        section{
            width: 100%;
            padding: 20px;
        }
        .cart-page {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            max-width: 800px;
            margin: auto;
        }

        .cart-title {
            font-size: 28px;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding: 20px 0;
        }

        .cart-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
        }

        .item-info {
            display: flex;
            align-items: center;
            font-weight: 600;
        }

        .item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-actions button {
            background: #5C7C57;
            border: none;
            color: white;
            font-size: 16px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
        }

        .item-price {
            color: #B58B42;
            font-weight: 600;
            font-size: 16px;
        }

        .cart-summary {
            margin-top: 30px;
            background: #fff;
            padding: 20px;
            border-radius: 12px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }

        .total-row .summary-value {
            font-weight: 600;
            font-size: 18px;
            color: #B58B42;
        }

        .checkout-btn {
            display: block;
            width: 100%;
            background: #5C7C57;
            color: white;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            margin-top: 20px;
        }

        .remove-btn {
            background: none;
            border: none;
            color: #e74c3c;
            font-size: 18px;
            cursor: pointer;
        }

        .empty-cart {
            text-align: center;
            padding: 40px;
        }

        .btnr1 {
            background: #5C7C57;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
        }
    </style>
</head>
<body>


<header>
    <a href="/" class="brand"> Ayubo Go</a>
    <div class="navigation">
        <div class="navigation-items">
            <a href="/">Home</a>
            <a href="/categories">Explore</a>
            <a href="/aboutus">About</a>
            <a href="/feedback">Blogs and reviews</a>

                <div class="search-container">
                <i class='bx bx-search'></i>
                <input type="text" class="search-bar" placeholder="Search...">

                </div>

            <button class="btn" href="/cart" id="cartbtn"><i class='bx bx-cart'></i> Cart</button>

            <button class="btn" id="loginBtn" >Login/Register</button>

        </div>
    </div>
</header>

<!-- Cart Page Section -->
 
<h1 class="cart-title" style="text-align: center;margin-top: 80px;color: white;">Your Cart</h1>
<section class="cart-page" id="cart-page">

    <div class="cart-items" id="cart-items-container">
        <div class="empty-cart" id="empty-cart-message">
            <p>Your cart is empty</p>
            <button class="btnr1" id="continue-shopping-btn">Continue Shopping</button>
        </div>
    </div>

    <div class="cart-summary" id="cart-summary" style="display: none;">
        <div class="summary-row">
            <span class="summary-title">Subtotal</span>
            <span class="summary-value" id="subtotal">$0.00</span>
        </div>
        <div class="summary-row">
            <span class="summary-title">Tax</span>
            <span class="summary-value" id="tax">$0.00</span>
        </div>
        <div class="summary-row total-row">
            <span class="summary-title">Total</span>
            <span class="summary-value total-value" id="total">$0.00</span>
        </div>
        <button class="btnr1" onclick="generateQuotation()">Download Quotation (PDF)</button>

        <a href="#" class="checkout-btn" id="checkout-btn">Proceed to Checkout</a>
    </div>
</section>


<!-- Edit Cart Modal -->
<div id="editCartModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal" onclick="closeEditModal()">&times;</span>
        <h2>Edit Reservation</h2>
        <form id="edit-cart-form">
            <input type="hidden" id="edit-index">

            <label>Adults:</label>
            <input type="number" id="edit-adults" min="0" required>

            <label>Children 1–5:</label>
            <input type="number" id="edit-children1_5" min="0" required>

            <label>Children 6–11:</label>
            <input type="number" id="edit-children6_11" min="0" required>

            <button type="submit" class="btnr1">Update</button>
        </form>
    </div>
</div>


<script>

function removeItem(index) {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    cart.splice(index, 1); // remove 1 item at given index
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartDisplay(); // refresh cart display
    window.location.reload();
}

const checkoutBtn = document.getElementById('checkout-btn');
checkoutBtn.addEventListener('click', () => {
    window.location.href = '/paymentmethod';
});

function updateCartDisplay() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const container = document.getElementById('cart-items-container');
    const emptyMsg = document.getElementById('empty-cart-message');
    const summary = document.getElementById('cart-summary');
    const subtotalEl = document.getElementById('subtotal');
    const taxEl = document.getElementById('tax');
    const totalEl = document.getElementById('total');

    container.innerHTML = '';

    if (cart.length === 0) {
        emptyMsg.style.display = 'block';
        summary.style.display = 'none';
        container.appendChild(emptyMsg);
        return;
    }

    emptyMsg.style.display = 'none';
    summary.style.display = 'block';

    let subtotal = 0;

    cart.forEach((item, index) => {
        const itemTotal = item.total;
        subtotal += itemTotal;

        // Format extras
        const extrasList = item.extras && item.extras.length > 0
            ? `<ul>${item.extras.map(extra => {
                const label = extra.label || 'Unnamed Extra';
                const cost = typeof extra.cost === 'number' ? `$${extra.cost.toFixed(2)}` : '$0.00';
                return `<li>${label} - ${cost}</li>`;
            }).join('')}</ul>`
            : `<em>No extras selected</em>`;

        // Create item display
        const row = document.createElement('div');
        row.className = 'cart-item';
        row.innerHTML = `
            <div class="item-info">
                <img src="${item.image || 'https://via.placeholder.com/50'}" alt="${item.vendor}">
                <div>
                    <strong>${item.vendor}</strong><br>
                    <small>Date: ${item.date} | Time: ${item.time}</small><br>
                    <small>User: ${item.customerName}</small><br>
                    <small>Adults: ${item.adults}, Children 1–5: ${item.children1_5}, Children 6–11: ${item.children6_11}</small><br>
                </div>
            </div>
            <div class="item-price">
                $${item.total.toFixed(2)}
            </div>
            <div class="item-actions">
                <button class="edit-btn" onclick="openEditModal(${index})">✏️</button>
                <button class="remove-btn" onclick="removeItem(${index})">🗑</button>
            </div>
        `;

        container.appendChild(row);
    });

    
    const cartSubtotal = cart.reduce((sum, item) => sum + item.total, 0);
    const cartTax = cartSubtotal * 0.10; // assuming 10% tax
    const cartTotal = cartSubtotal + cartTax;

    const cartData = {  
        items: cart,
        subtotal: parseFloat(cartSubtotal.toFixed(2)),
        tax: parseFloat(cartTax.toFixed(2)),
        total: parseFloat(cartTotal.toFixed(2))
    };
    document.getElementById('total').textContent = cartTotal.toFixed(2);
    document.getElementById('subtotal').textContent = cartSubtotal.toFixed(2);
    document.getElementById('tax').textContent = cartTax.toFixed(2);
    updateCartTotals();
    
}
document.getElementById('edit-cart-form').addEventListener('submit', function(e) {
    e.preventDefault(); // Stop form from refreshing the page
    saveCartChanges();
});

// Continue Shopping
document.getElementById('continue-shopping-btn').addEventListener('click', () => {
    window.location.href = '/';
});

updateCartDisplay();

function openEditModal(index) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const item = cart[index];
    
        document.getElementById('edit-index').value = index;
        document.getElementById('edit-adults').value = item.adults;
        document.getElementById('edit-children1_5').value = item.children1_5;
        document.getElementById('edit-children6_11').value = item.children6_11;
    
    
        document.getElementById('editCartModal').style.display = 'block';
    }
    
    function closeEditModal() {
        document.getElementById('editCartModal').style.display = 'none';
    }
    
    document.getElementById('edit-cart-form').addEventListener('submit', function(e) {
        e.preventDefault();
    
        const index = parseInt(document.getElementById('edit-index').value);
        const adults = parseInt(document.getElementById('edit-adults').value);
        const children1_5 = parseInt(document.getElementById('edit-children1_5').value);
        const children6_11 = parseInt(document.getElementById('edit-children6_11').value);
    
        const basePrice = item.total;
        basePrice = basePrice / (adults + children1_5 + children6_11);
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        const taxRate = 0.10;
        const subTotal = (basePrice * adults) + (basePrice * 0.5 * children1_5) + (basePrice * 0.75 * children6_11);
        const tax = subTotal * taxRate;
        const total = subTotal + tax;
        
        
        let item = cart[index];
    
        
    
        // Filter selected extras
        const selectedExtras = Array.from(document.querySelectorAll('.edit-extra'))
            .filter(e => e.checked)
            .map(e => ({
                label: e.dataset.label,
                cost: parseFloat(e.dataset.cost)
            }));
    
        const extrasCost = selectedExtras.reduce((sum, ex) => sum + ex.cost, 0);
        const updatedTotal = basePrice + extrasCost;
    
        cart[index] = {
            ...item,
            adults,
            children1_5,
            children6_11,
            extras: selectedExtras,
            total: updatedTotal
        };
    
        localStorage.setItem('cart', JSON.stringify(cart));
        closeEditModal();
        updateCartDisplay();
        window.location.reload();
    });


    function saveCartChanges() {
    const index = parseInt(document.getElementById('edit-index').value);
    const adults = parseInt(document.getElementById('edit-adults').value);
    const children1_5 = parseInt(document.getElementById('edit-children1_5').value);
    const children6_11 = parseInt(document.getElementById('edit-children6_11').value);

    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const item = cart[index];

    item.adults = adults;
    item.children1_5 = children1_5;
    item.children6_11 = children6_11;

    const adultPrice = 10;
    const child1_5Price = 5;
    const child6_11Price = 7;

    item.total = (adults * adultPrice) + (children1_5 * child1_5Price) + (children6_11 * child6_11Price);

    cart[index] = item;
    localStorage.setItem('cart', JSON.stringify(cart));

    updateCartTotals();
    closeEditModal();
    updateCartDisplay();
    window.location.reload();
}



function saveEditChanges(index) {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];

    const adults = parseInt(document.getElementById('edit-adults').value) || 0;
    const children1_5 = parseInt(document.getElementById('edit-children1_5').value) || 0;
    const children6_11 = parseInt(document.getElementById('edit-children6_11').value) || 0;

    const selectedExtras = [];
    document.querySelectorAll('.edit-extra:checked').forEach(extra => {
        const label = extra.dataset.label;
        const cost = parseFloat(extra.dataset.cost) || 0;
        selectedExtras.push({ label, cost });
    });

    const adultsPrice = adults * 10;
    const kids5Price = children1_5 * 5;
    const kids11Price = children6_11 * 7;
    const extrasTotal = selectedExtras.reduce((sum, e) => sum + e.cost, 0);

    const total = adultsPrice + kids5Price + kids11Price + extrasTotal;

    cart[index].adults = adults;
    cart[index].children1_5 = children1_5;
    cart[index].children6_11 = children6_11;
    cart[index].extras = selectedExtras;
    cart[index].total = total;

    localStorage.setItem('cart', JSON.stringify(cart));

    updateCartTotals();
    closeEditModal();
    updateCartDisplay();
    window.location.reload();
}

        async function generateQuotation() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const cart = JSON.parse(localStorage.getItem('cart')) || [];

            if (cart.length === 0) {
                alert("Cart is empty. Cannot generate quotation.");
                return;
            }

            let y = 10;
            doc.setFontSize(18);
            doc.text("QUOTATION", 105, y, { align: "center" });

            y += 10;
            doc.setFontSize(12);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 14, y);

            y += 10;
            let subtotal = 0;

            cart.forEach((item, i) => {
                const sectionTop = y;

                doc.setFontSize(14);
                doc.text(`Item ${i + 1}: ${item.vendor}`, 14, y);
                y += 8;

                doc.setFontSize(12);
                doc.text(`Date: ${item.date}    Time: ${item.time}`, 14, y); y += 6;
                doc.text(`Customer: ${item.customerName}`, 14, y); y += 6;
                doc.text(`Adults: ${item.adults} | Children 1–5: ${item.children1_5} | Children 6–11: ${item.children6_11}`, 14, y); y += 6;

                if (item.extras && item.extras.length > 0) {
                    doc.text("Extras:", 14, y);
                    y += 6;
                    item.extras.forEach(extra => {
                        const label = extra.label || "Unnamed Extra";
                        const cost = typeof extra.cost === 'number' ? extra.cost.toFixed(2) : "0.00";
                        doc.text(`• ${label}: $${cost}`, 18, y);
                        y += 6;
                    });
                } else {
                    doc.text("Extras: None", 14, y);
                    y += 6;
                }

                const total = item.total || 0;
                doc.setFont("helvetica", "bold");
                doc.text(`Item Total: $${total.toFixed(2)}`, 14, y);
                doc.setFont("helvetica", "normal");
                y += 10;

                subtotal += total;

                // Add new page if needed
                if (y > 270) {
                    doc.addPage();
                    y = 10;
                }
            });

            const tax = subtotal * 0.10;
            const grandTotal = subtotal + tax;

            doc.setFontSize(14);
            doc.text("Summary", 105, y, { align: "center" });
            y += 10;

            doc.setFontSize(12);
            doc.text(`Subtotal: $${subtotal.toFixed(2)}`, 14, y); y += 6;
            doc.text(`Tax (10%): $${tax.toFixed(2)}`, 14, y); y += 6;
            doc.setFont("helvetica", "bold");
            doc.text(`Total: $${grandTotal.toFixed(2)}`, 14, y);
            doc.setFont("helvetica", "normal");

            y += 15;
            doc.setFontSize(10);
            doc.text("Thank you for your interest in our cultural experiences!", 14, y);
            y += 5;
            doc.text("This is a system-generated quotation and does not require a signature.", 14, y);

            doc.save("quotation.pdf");
        }

        function updateCartTotals() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const subtotal = cart.reduce((sum, item) => sum + item.total, 0);
            const tax = subtotal * 0.10; // 10% tax
            const total = subtotal + tax;

            const cartData = {
                items: cart,
                subtotal: parseFloat(subtotal.toFixed(2)),
                tax: parseFloat(tax.toFixed(2)),
                total: parseFloat(total.toFixed(2))
            };

            localStorage.setItem('cartData', JSON.stringify(cartData));

            // Optional UI update
            document.getElementById('subtotal').textContent = cartData.subtotal.toFixed(2);
            document.getElementById('tax').textContent = cartData.tax.toFixed(2);
            document.getElementById('total').textContent = cartData.total.toFixed(2);
        }
        </script>
        
</body>
</html>
