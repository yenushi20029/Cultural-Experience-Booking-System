<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tourist Dashboard</title>

  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  
  <!-- Add Chart.js library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Add jsPDF library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root {
      --primary-color: #597E52;
      --primary-dark: #3b4a34;
      --primary-light: #8AAE7F;
      --accent-color: #C6A969;
      --accent-dark: #A68A56;
      --text-dark: #023047;
      --text-light: #6c757d;
      --bg-light: #f8f9fa;
      --bg-white: #ffffff;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
      --shadow-lg: 0 8px 24px rgba(0,0,0,0.2);
      --transition: all 0.3s ease;
      --border-radius: 12px;
      --border-radius-sm: 8px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      display: flex;
      min-height: 100vh;
      background-color: var(--bg-light);
      color: var(--text-dark);
      line-height: 1.6;
    }

    .sidebar {
      width: 280px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      padding: 25px 20px;
      position: relative;
      z-index: 10;
      box-shadow: var(--shadow-md);
      transition: var(--transition);
    }

    .sidebar h2 {
      margin-bottom: 30px;
      font-size: 24px;
      text-align: center;
      font-weight: 700;
      position: relative;
      padding-bottom: 15px;
    }

    .sidebar h2::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: var(--accent-color);
      border-radius: 3px;
    }

    .sidebar ul {
      list-style: none;
      margin-top: 30px;
    }

    .sidebar ul li {
      margin: 15px 0;
      position: relative;
    }

    .sidebar ul li a {
      text-decoration: none;
      color: rgba(255, 255, 255, 0.9);
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: var(--transition);
      padding: 10px 15px;
      border-radius: var(--border-radius-sm);
    }

    .sidebar ul li a i {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .sidebar ul li a:hover {
      color: white;
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }

    .sidebar ul li.active a {
      color: var(--accent-color);
      background: rgba(198, 169, 105, 0.1);
      font-weight: 500;
    }

    .sidebar ul li a:hover::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 3px;
      background: var(--accent-color);
      border-radius: 0 3px 3px 0;
    }

    .main-content {
      flex: 1;
      padding: 30px 40px;
      overflow-y: auto;
      background-color: var(--bg-light);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 20px;
    }

    .main-content h1 {
      font-size: 32px;
      color: var(--text-dark);
      font-weight: 700;
      position: relative;
      display: inline-block;
    }

    .main-content h1::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 60px;
      height: 4px;
      background: linear-gradient(to right, var(--accent-color), var(--primary-color));
      border-radius: 2px;
    }

    .search-container {
      position: relative;
      width: 280px;
    }

    .search-container input {
      width: 100%;
      padding: 12px 15px 12px 45px;
      border: 1px solid #ddd;
      border-radius: 30px;
      outline: none;
      transition: var(--transition);
      font-size: 14px;
      background-color: var(--bg-white);
      box-shadow: var(--shadow-sm);
    }

    .search-container input:focus {
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(89, 126, 82, 0.2);
    }

    .search-container i {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
      font-size: 18px;
    }

    .card {
      margin-top: 30px;
      background-color: var(--bg-white);
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
      border-left: 4px solid var(--primary-color);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .card h2 {
      color: var(--primary-dark);
      font-size: 22px;
      margin-bottom: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card h2 i {
      color: var(--accent-color);
    }

    .card p {
      font-size: 15px;
      color: var(--text-light);
      margin-bottom: 15px;
    }

    .card ul {
      margin-top: 20px;
      list-style: none;
      padding-left: 0;
    }

    .card ul li {
      margin-bottom: 12px;
      font-size: 15px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .card ul li i {
      color: var(--primary-color);
      font-size: 18px;
      margin-top: 2px;
    }

    .card .tip {
      margin-top: 25px;
      padding: 15px;
      background-color: rgba(89, 126, 82, 0.08);
      border-left: 4px solid var(--accent-color);
      border-radius: var(--border-radius-sm);
    }

    .card .tip strong {
      color: var(--primary-dark);
      font-weight: 600;
    }

    /* Activity boxes styles */
    .activity-boxes {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 25px;
      margin-top: 35px;
    }

    .activity-box {
      background-color: var(--bg-white);
      padding: 25px 20px;
      text-align: center;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
      cursor: pointer;
      border: none;
      outline: none;
      position: relative;
      overflow: hidden;
      border-top: 3px solid var(--primary-color);
    }

    .activity-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to right, var(--primary-color), var(--accent-color));
      opacity: 0;
      transition: var(--transition);
    }

    .activity-box:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .activity-box:hover::before {
      opacity: 1;
    }

    .activity-box i {
      font-size: 40px;
      color: var(--primary-color);
      margin-bottom: 15px;
      display: inline-block;
      transition: var(--transition);
    }

    .activity-box:hover i {
      transform: scale(1.1);
      color: var(--accent-color);
    }

    .activity-box h3 {
      margin-top: 10px;
      color: var(--primary-dark);
      font-size: 18px;
      font-weight: 600;
    }

    .activity-box p {
      margin-top: 10px;
      font-size: 14px;
      color: var(--text-light);
      line-height: 1.5;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      backdrop-filter: blur(3px);
      transition: var(--transition);
    }

    .modal-content {
      background-color: var(--bg-white);
      margin: 10% auto;
      padding: 30px;
      border-radius: var(--border-radius);
      width: 50%;
      max-width: 600px;
      box-shadow: var(--shadow-lg);
      transform: translateY(-50px);
      opacity: 0;
      transition: all 0.4s ease;
      border-top: 5px solid var(--primary-color);
    }

    .modal.show .modal-content {
      transform: translateY(0);
      opacity: 1;
    }

    .close {
      color: var(--text-light);
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
    }

    .close:hover {
      color: var(--primary-dark);
      transform: rotate(90deg);
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 500;
      color: var(--primary-dark);
    }

    .form-group select, 
    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius-sm);
      font-size: 15px;
      transition: var(--transition);
      background-color: var(--bg-white);
    }

    .form-group select:focus, 
    .form-group input:focus {
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(89, 126, 82, 0.2);
      outline: none;
    }

    .form-group button {
      background: linear-gradient(to right, var(--primary-color), var(--primary-dark));
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: var(--transition);
      width: 100%;
      box-shadow: var(--shadow-sm);
    }

    .form-group button:hover {
      background: linear-gradient(to right, var(--primary-dark), var(--primary-color));
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .form-group button:active {
      transform: translateY(0);
    }

    #report-results {
      margin-top: 30px;
      padding: 20px;
      border: 1px solid #eee;
      border-radius: var(--border-radius-sm);
      background-color: var(--bg-light);
      transition: var(--transition);
    }

    #report-results h3 {
      color: var(--primary-dark);
      margin-bottom: 15px;
      font-size: 18px;
    }

    /* Profile picture styles */
    .profile-picture-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 25px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: var(--border-radius);
      transition: var(--transition);
    }

    .profile-picture-container:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-3px);
    }

    .profile-picture-container img {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      margin-bottom: 15px;
      object-fit: cover;
      border: 3px solid var(--accent-color);
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
    }

    .profile-picture-container:hover img {
      transform: scale(1.05);
    }

    .profile-picture-container input[type="file"] {
      display: none;
    }

    .profile-picture-container label {
      padding: 8px 20px;
      background: var(--accent-color);
      color: var(--text-dark);
      border-radius: 30px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 14px;
      font-weight: 500;
      width: fit-content;
      box-shadow: var(--shadow-sm);
    }

    .profile-picture-container label:hover {
      background: var(--accent-dark);
      color: white;
      box-shadow: var(--shadow-md);
    }

    /* Search results styling */
    .search-highlight {
      background-color: rgba(255, 217, 0, 0.3);
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: 500;
    }

    .hidden {
      display: none !important;
    }

    .no-results {
      text-align: center;
      padding: 30px;
      font-size: 16px;
      color: var(--text-light);
      grid-column: 1 / -1;
      background: var(--bg-white);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
    }

    /* Table styles for reports */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
    }

    tr:nth-child(even) {
      background-color: rgba(89, 126, 82, 0.05);
    }

    tr:hover {
      background-color: rgba(89, 126, 82, 0.1);
    }

    /* Download button */
    #report-results button {
      background: linear-gradient(to right, var(--primary-color), var(--accent-color));
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      transition: var(--transition);
      margin-top: 15px;
      box-shadow: var(--shadow-sm);
    }

    #report-results button:hover {
      background: linear-gradient(to right, var(--accent-color), var(--primary-color));
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    /* Chart container styles */
    .chart-container {
      position: relative;
      width: 100%;
      margin: 25px 0;
      background: var(--bg-white);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
    }

    .chart-container h3 {
      color: var(--primary-dark);
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chart-container h3 i {
      color: var(--accent-color);
    }

    .chart-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .chart-row {
        grid-template-columns: 1fr;
      }
    }

    /* Stats cards */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .stat-card {
      background: var(--bg-white);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
      text-align: center;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .stat-card .value {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary-dark);
      margin: 10px 0;
    }

    .stat-card .label {
      font-size: 14px;
      color: var(--text-light);
    }

    .stat-card.completed {
      border-top: 3px solid #2e7d32;
    }

    .stat-card.upcoming {
      border-top: 3px solid #ff8f00;
    }

    .stat-card.total {
      border-top: 3px solid #424242;
    }

    /* Voice command button styles */
    .voice-command-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 1000;
      transition: var(--transition);
      border: none;
    }

    .voice-command-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
    }

    .voice-command-btn i {
      font-size: 24px;
    }

    .voice-command-btn.listening {
      animation: pulse 1.5s infinite;
      background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    /* Voice command modal */
    .voice-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .voice-modal-content {
      background: white;
      padding: 30px;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 500px;
      text-align: center;
      box-shadow: var(--shadow-lg);
      position: relative;
    }

    .voice-modal h3 {
      color: var(--primary-dark);
      margin-bottom: 20px;
      font-size: 22px;
    }

    .voice-feedback {
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 20px 0;
      font-size: 18px;
      color: var(--text-dark);
    }

    .voice-commands-list {
      text-align: left;
      margin-top: 20px;
      padding: 15px;
      background: rgba(89, 126, 82, 0.1);
      border-radius: var(--border-radius-sm);
    }

    .voice-commands-list h4 {
      color: var(--primary-dark);
      margin-bottom: 10px;
    }

    .voice-commands-list ul {
      list-style-type: none;
    }

    .voice-commands-list li {
      margin-bottom: 8px;
      padding-left: 20px;
      position: relative;
    }

    .voice-commands-list li:before {
      content: 'â€¢';
      position: absolute;
      left: 0;
      color: var(--primary-color);
      font-weight: bold;
    }

    /* Responsive styling */
    @media (max-width: 992px) {
      .sidebar {
        width: 240px;
        padding: 20px 15px;
      }
      
      .main-content {
        padding: 25px;
      }
      
      .modal-content {
        width: 70%;
      }
    }

    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        padding: 15px;
      }
      
      .main-content {
        padding: 20px;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .search-container {
        width: 100%;
        margin-top: 15px;
      }

      .modal-content {
        width: 85%;
        padding: 20px;
      }
      
      .voice-command-btn {
        width: 50px;
        height: 50px;
        bottom: 20px;
        right: 20px;
      }
    }

    @media (max-width: 576px) {
      .activity-boxes {
        grid-template-columns: 1fr;
      }

      .modal-content {
        width: 95%;
        padding: 15px;
      }
      
      .profile-picture-container {
        padding: 10px;
      }
      
      .profile-picture-container img {
        width: 70px;
        height: 70px;
      }
      
      .voice-modal-content {
        padding: 20px 15px;
      }
    }

    /* Animations */
    .animate-pop {
      animation: popIn 0.4s ease-out forwards;
    }

    @keyframes popIn {
      0% {
        transform: scale(0.8);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Floating animation for activity boxes */
    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    .activity-box:nth-child(1) {
      animation: float 6s ease-in-out infinite;
    }
    .activity-box:nth-child(2) {
      animation: float 6s ease-in-out infinite 1s;
    }
    .activity-box:nth-child(3) {
      animation: float 6s ease-in-out infinite 2s;
    }
    .activity-box:nth-child(4) {
      animation: float 6s ease-in-out infinite 3s;
    }

    /* Pulse animation for welcome card */
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(89, 126, 82, 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(89, 126, 82, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(89, 126, 82, 0);
      }
    }

    .card {
      animation: pulse 2s infinite;
    }

    /* Stop animations when reduced motion is preferred */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>
<body>

  <div class="sidebar" action="/userdash">
    <h2>Your Dashboard</h2>
    <div class="profile-picture-container">
        <p for="welcome-name" id="welcome-name" style=" margin-bottom: 20px; margin-top: 20px;"></p>
        <img id="profile-picture" src="https://randomuser.me/api/portraits/women/50.jpg" alt="Profile Picture">
        <label for="upload-picture">Upload Picture</label>
        <input type="file" id="upload-picture" accept="image/*" onchange="previewProfilePicture(event)">
    </div>
    <ul>
      <li class="active"><a href="/categories"><i class='bx bx-map'></i> Book Experience</a></li>
      <li><a href="#"><i class='bx bxs-book-bookmark'></i> My Bookings</a></li>
      <li><a href="/profile"><i class='bx bxs-user'></i> Profile</a></li>
      <li><a href="/managepassword"><i class='bx bxs-lock-alt'></i> Manage Password</a></li>
      <li><a href="/logout" id="logout-link"><i class='bx bx-log-out'></i> Log Out</a></li>
    </ul>
  </div>

  <div class="main-content">
    <div class="header">
      <h1 class="animate__animated animate__fadeIn">Welcome Back!</h1>
      <div class="search-container">
        <i class='bx bx-search'></i>
        <input type="text" id="dashboard-search" placeholder="Search dashboard..." oninput="searchDashboard()">
      </div>
    </div>
    
    <div class="card animate__animated animate__fadeInUp" id="welcome-card">
      <h2><i class='bx bx-compass'></i> Discover Authentic Sri Lankan Culture</h2>
      <p>
        We're excited to have you explore the heart of Sri Lanka through immersive cultural experiences. From traditional crafts to local cuisine, your journey to authenticity starts here.
      </p>

      <ul>
        <li><i class='bx bx-map'></i> Book your next cultural experience</li>
        <li><i class='bx bxs-book-bookmark'></i> View and manage your upcoming bookings</li>
        <li><i class='bx bxs-user'></i> Update your profile information and preferences</li>
      </ul>

      <div class="tip">
        <strong>Travel Tip:</strong> Start by browsing the "Book Experience" section to find unique cultural activities near you! Our most popular experiences include traditional mask carving and Kandyan dance workshops.
      </div>

      <p>
        Your participation supports local communities and promotes sustainable tourism practices in Sri Lanka. Thank you for being a responsible traveler!
      </p>
    </div>

    <!-- Stats Overview Section -->
    <div class="stats-container" id="stats-container">
      <!-- In your HTML, change the completed stat card to this: -->
<div class="stat-card completed" onclick="viewCompletedExperiences()">
  <i class='bx bx-check-circle' style="font-size:24px; color:#2e7d32;"></i>
  <div class="value" id="completed-count">0</div>
  <div class="label">Completed Experiences</div>
</div>
      <div class="stat-card upcoming">
        <i class='bx bx-calendar' style="font-size:24px; color:#ff8f00;"></i>
        <div class="value" id="upcoming-count">0</div>
        <div class="label">Upcoming Experiences</div>
      </div>
      <div class="stat-card total">
        <i class='bx bx-stats' style="font-size:24px; color:#424242;"></i>
        <div class="value" id="total-count">0</div>
        <div class="label">Total Experiences</div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="chart-container">
      <h3><i class='bx bx-bar-chart-alt'></i> Your Cultural Experiences Overview</h3>
      <div class="chart-row">
        <div>
          <canvas id="activityTypeChart"></canvas>
        </div>
        <div>
          <canvas id="statusChart"></canvas>
        </div>
      </div>
      <div class="chart-row">
        <div>
          <canvas id="monthlyActivityChart"></canvas>
        </div>
        <div>
          <canvas id="ratingChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Activity Boxes Section -->
    <div class="activity-boxes" id="activity-boxes">
      <button class="activity-box animate__animated animate__fadeInUp" onclick="openReportDialog()">
        <i class='bx bxs-report'></i>
        <h3>Generate Report</h3>
        <p>Create detailed summaries of your cultural experiences and activities in PDF or CSV format.</p>
      </button>
      <button class="activity-box animate__animated animate__fadeInUp" onclick="viewBookings()">
        <i class='bx bxs-bookmark-alt'></i>
        <h3>My Bookings</h3>
        <p>View and manage your upcoming bookings for cultural experiences and workshops.</p>
      </button>
      <button class="activity-box animate__animated animate__fadeInUp" onclick="viewRecentTasks()">
        <i class='bx bx-history'></i>
        <h3>Activity History</h3>
        <p>Review your recent cultural activities, bookings, and system interactions.</p>
      </button>
      <button class="activity-box animate__animated animate__fadeInUp" onclick="contactSupport()">
        <i class='bx bx-support'></i>
        <h3>Contact Support</h3>
        <p>Get assistance for any issues or questions about your cultural experiences.</p>
      </button>
    </div>
  </div>

  <!-- Report Generation Modal -->
  <div id="report-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeReportDialog()">&times;</span>
      <h2><i class='bx bxs-report'></i> Generate Detail Summary Report</h2>
      <form id="report-form">
        <div class="form-group">
          <label for="date-range"><i class='bx bx-calendar'></i> Time Range:</label>
          <select id="date-range" onchange="toggleCustomDateRange()">
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month">This Month</option>
            <option value="year">This Year</option>
            <option value="all">All Activities</option>
          </select>
        </div>
        <div class="form-group">
          <label for="format"><i class='bx bx-file'></i> Format:</label>
          <select id="format">
            <option value="pdf">PDF Document</option>
            <option value="csv">CSV Spreadsheet</option>
          </select>
        </div>
        <div class="form-group">
          <button type="button" onclick="generateReportFromDB()">
            <i class='bx bx-download'></i> Generate Report
          </button>
        </div>
      </form>
      <div id="report-results" class="hidden">
        <h3><i class='bx bx-data'></i> Report Results</h3>
        <div id="report-data"></div>
        <button onclick="downloadReport()">
          <i class='bx bx-download'></i> Download Report
        </button>
      </div>
    </div>
  </div>
  
  <!-- Voice Command Button -->
  <button class="voice-command-btn" id="voice-command-btn" title="Voice Commands">
    <i class='bx bx-microphone'></i>
  </button>
  
  <!-- Voice Command Modal -->
  <div class="voice-modal" id="voice-modal">
    <div class="voice-modal-content">
      <h3>Voice Command Assistant</h3>
      <div class="voice-feedback" id="voice-feedback">
        Click the microphone button and speak your command...
      </div>
      <button class="voice-command-btn listening" id="modal-voice-btn" style="margin: 0 auto;">
        <i class='bx bx-microphone'></i>
      </button>
      
      <div class="voice-commands-list">
        <h4>Available Commands:</h4>
        <ul>
          <li>"Show my bookings" - View your upcoming experiences</li>
          <li>"Generate report" - Open the report generation dialog</li>
          <li>"Search for [text]" - Search the dashboard</li>
          <li>"View profile" - Go to your profile page</li>
          <li>"Log out" - Sign out of your account</li>
          <li>"Help" - Show available commands</li>
        </ul>
      </div>
      
      <button onclick="closeVoiceModal()" style="margin-top: 20px; background: var(--primary-color); color: white; border: none; padding: 10px 20px; border-radius: var(--border-radius-sm); cursor: pointer;">
        Close
      </button>
    </div>
  </div>

  <script>
      function getFullNameFromCookies() {
          const cookies = `; ${document.cookie}`;

          const firstParts = cookies.split(`; user_first_name=`);
          const firstName = (firstParts.length === 2) ? firstParts.pop().split(';').shift() : '';

          const lastParts = cookies.split(`; user_last_name=`);
          const lastName = (lastParts.length === 2) ? lastParts.pop().split(';').shift() : '';
          return `${firstName} ${lastName}`.trim(); // return full name
      }

    const welcomeName = document.getElementById('welcome-name');
    const loggedUser = getFullNameFromCookies();
    welcomeName.textContent = `${loggedUser}`;

    function viewCompletedExperiences() {
      // Filter completed experiences
      const completedExperiences = activityData.filter(item => item.status === 'Completed');
      
      // Store in sessionStorage to pass to the next page
      sessionStorage.setItem('completedExperiences', JSON.stringify(completedExperiences));
      
      // Redirect to ratings page
      window.location.href = '/rate';
    }
    
    // Initialize jsPDF with proper error handling
    let jsPDF;
    try {
      jsPDF = window.jspdf.jsPDF;
      console.log("jsPDF library loaded successfully");
    } catch (error) {
      console.error("Failed to load jsPDF:", error);
      alert("PDF generation library failed to load. Please refresh the page.");
    }

    // Sample data for charts
    const activityData = [
      { 
        id: 140, 
        activity: 'Traditional Handloom Weaving Workshop', 
        date: '2025-04-27', 
        status: 'Completed',
        duration: '3 hours',
        location: 'Kandy',
        rating: '5/5',
        type: 'Workshop'
      },
      { 
               id: 141,
        activity: 'Traditional Mask Carving Experience', 
        date: '2025-04-28', 
        status: 'Upcoming',
        duration: '2 hours',
        location: 'Ambalangoda',
        rating: 'Not rated yet',
        type: 'Workshop'
      },
      { 
        id: 142,
        activity: 'Kandyan Dance Performance', 
        date: '2025-05-05', 
        status: 'Upcoming',
        duration: '1.5 hours',
        location: 'Kandy',
        rating: 'Not rated yet',
        type: 'Performance'
      },
      { 
        id: 143,
        activity: 'Sri Lankan Cooking Class', 
        date: '2025-05-12', 
        status: 'Upcoming',
        duration: '4 hours',
        location: 'Colombo',
        rating: 'Not rated yet',
        type: 'Culinary'
      },
      { 
        id: 144,
        activity: 'Tea Plantation Tour', 
        date: '2025-04-15', 
        status: 'Completed',
        duration: '5 hours',
        location: 'Nuwara Eliya',
        rating: '4/5',
        type: 'Tour'
      }
    ];

    // Initialize charts when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      updateStats();
      initCharts();
      setupEventListeners();
    });

    // Update statistics counters
    function updateStats() {
      const completed = activityData.filter(item => item.status === 'Completed').length;
      const upcoming = activityData.filter(item => item.status === 'Upcoming').length;
      
      document.getElementById('completed-count').textContent = completed;
      document.getElementById('upcoming-count').textContent = upcoming;
      document.getElementById('total-count').textContent = activityData.length;
    }

    // Initialize all charts
    function initCharts() {
      // Activity Type Chart (Pie)
      const typeCtx = document.getElementById('activityTypeChart').getContext('2d');
      const typeCounts = {};
      
      activityData.forEach(item => {
        typeCounts[item.type] = (typeCounts[item.type] || 0) + 1;
      });
      
      new Chart(typeCtx, {
        type: 'pie',
        data: {
          labels: Object.keys(typeCounts),
          datasets: [{
            data: Object.values(typeCounts),
            backgroundColor: [
              '#597E52',
              '#8AAE7F',
              '#C6A969',
              '#A68A56'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Status Chart (Doughnut)
      const statusCtx = document.getElementById('statusChart').getContext('2d');
      const statusCounts = {};
      
      activityData.forEach(item => {
        statusCounts[item.status] = (statusCounts[item.status] || 0) + 1;
      });
      
      new Chart(statusCtx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(statusCounts),
          datasets: [{
            data: Object.values(statusCounts),
            backgroundColor: [
              '#2e7d32',
              '#ff8f00',
              '#424242'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });

      // Monthly Activity Chart (Bar)
      const monthlyCtx = document.getElementById('monthlyActivityChart').getContext('2d');
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
      const monthlyCounts = [0, 0, 2, 3, 2, 0]; // Sample data
      
      new Chart(monthlyCtx, {
        type: 'bar',
        data: {
          labels: months,
          datasets: [{
            label: 'Activities per Month',
            data: monthlyCounts,
            backgroundColor: '#597E52',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Rating Chart (Horizontal Bar)
      const ratingCtx = document.getElementById('ratingChart').getContext('2d');
      const ratings = ['5/5', '4/5', '3/5', '2/5', '1/5'];
      const ratingCounts = [1, 1, 0, 0, 0]; // Sample data
      
      new Chart(ratingCtx, {
        type: 'bar',
        data: {
          labels: ratings,
          datasets: [{
            label: 'Rating Distribution',
            data: ratingCounts,
            backgroundColor: '#C6A969',
            borderWidth: 1
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          scales: {
            x: {
              beginAtZero: true
            }
          }
        }
      });
    }

    // Setup event listeners
    function setupEventListeners() {
      // Voice command button
      const voiceBtn = document.getElementById('voice-command-btn');
      const modalVoiceBtn = document.getElementById('modal-voice-btn');
      const voiceModal = document.getElementById('voice-modal');
      
      voiceBtn.addEventListener('click', openVoiceModal);
      modalVoiceBtn.addEventListener('click', toggleVoiceRecognition);
      
      // Profile picture upload
      const uploadBtn = document.getElementById('upload-picture');
      uploadBtn.addEventListener('change', previewProfilePicture);
      
      // Logout link
      const logoutLink = document.getElementById('logout-link');
      logoutLink.addEventListener('click', function(e) {
        e.preventDefault();
        if (confirm('Are you sure you want to log out?')) {
          // In a real app, you would call your logout API here
          window.location.href = '/logout';
        }
      });
    }

    // Profile picture preview
    function previewProfilePicture(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('profile-picture').src = e.target.result;
          // In a real app, you would upload the image to your server here
          alert('Profile picture updated successfully!');
        };
        reader.readAsDataURL(file);
      }
    }

    // Search functionality
    function searchDashboard() {
      const searchTerm = document.getElementById('dashboard-search').value.toLowerCase();
      if (!searchTerm) {
        // Reset all elements if search is empty
        document.querySelectorAll('.hidden-search').forEach(el => {
          el.classList.remove('hidden-search');
        });
        return;
      }
      
      let hasResults = false;
      const searchableElements = document.querySelectorAll('.card, .activity-box, .chart-container h3, .stats-container .stat-card');
      
      searchableElements.forEach(el => {
        const text = el.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
          el.classList.remove('hidden-search');
          hasResults = true;
          
          // Highlight matching text (simple implementation)
          if (el.classList.contains('card') || el.classList.contains('activity-box')) {
            const html = el.innerHTML;
            const highlighted = html.replace(
              new RegExp(searchTerm, 'gi'),
              match => `<span class="search-highlight">${match}</span>`
            );
            el.innerHTML = highlighted;
          }
        } else {
          el.classList.add('hidden-search');
        }
      });
      
      // Show no results message if needed
      const noResults = document.getElementById('no-results');
      if (!hasResults) {
        if (!noResults) {
          const noResultsEl = document.createElement('div');
          noResultsEl.id = 'no-results';
          noResultsEl.className = 'no-results';
          noResultsEl.textContent = `No results found for "${searchTerm}"`;
          document.querySelector('.main-content').appendChild(noResultsEl);
        }
      } else if (noResults) {
        noResults.remove();
      }
    }

    // Report generation functions
    function openReportDialog() {
      document.getElementById('report-modal').style.display = 'block';
      setTimeout(() => {
        document.getElementById('report-modal').classList.add('show');
      }, 10);
    }

    function closeReportDialog() {
      document.getElementById('report-modal').classList.remove('show');
      setTimeout(() => {
        document.getElementById('report-modal').style.display = 'none';
      }, 300);
    }

    function toggleCustomDateRange() {
      const dateRange = document.getElementById('date-range').value;
      const customRangeDiv = document.getElementById('custom-range-div');
      
      if (dateRange === 'custom') {
        customRangeDiv.style.display = 'block';
      } else {
        customRangeDiv.style.display = 'none';
      }
    }

    function generateReportFromDB() {
      // In a real app, this would fetch data from your database
      // For now, we'll use the sample activityData
      
      const dateRange = document.getElementById('date-range').value;
      const format = document.getElementById('format').value;
      
      let filteredData = [...activityData];
      
      // Filter by date range (simplified for demo)
      if (dateRange === 'today') {
        filteredData = filteredData.filter(item => item.date === new Date().toISOString().split('T')[0]);
      } else if (dateRange === 'week') {
        // This would be more complex in a real app
        filteredData = filteredData.slice(0, 2);
      } else if (dateRange === 'month') {
        filteredData = filteredData.slice(0, 3);
      }
      
      // Display results
      const reportResults = document.getElementById('report-results');
      const reportData = document.getElementById('report-data');
      
      reportData.innerHTML = `
        <p>Report generated for: ${dateRange}</p>
        <p>Found ${filteredData.length} activities</p>
        <table>
          <thead>
            <tr>
              <th>Activity</th>
              <th>Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            ${filteredData.map(item => `
              <tr>
                <td>${item.activity}</td>
                <td>${item.date}</td>
                <td>${item.status}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      reportResults.classList.remove('hidden');
      
      // Scroll to results
      reportResults.scrollIntoView({ behavior: 'smooth' });
    }

    function downloadReport() {
      const format = document.getElementById('format').value;
      
      if (format === 'pdf') {
        generatePDF();
      } else {
        generateCSV();
      }
    }

    function generatePDF() {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Add title
        doc.setFontSize(18);
        doc.setTextColor(89, 126, 82);
        doc.text('Cultural Experiences Report', 105, 20, { align: 'center' });
        
        // Add date
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
        
        // Add table
        doc.autoTable({
          head: [['Activity', 'Date', 'Status', 'Rating']],
          body: activityData.map(item => [item.activity, item.date, item.status, item.rating]),
          startY: 40,
          theme: 'grid',
          headStyles: {
            fillColor: [89, 126, 82],
            textColor: 255
          },
          alternateRowStyles: {
            fillColor: [242, 242, 242]
          }
        });
        
        // Save the PDF
        doc.save('cultural_experiences_report.pdf');
      } catch (error) {
        console.error('Error generating PDF:', error);
        alert('Failed to generate PDF. Please try again.');
      }
    }

    function generateCSV() {
      let csv = 'Activity,Date,Status,Rating,Type,Location,Duration\n';
      
      activityData.forEach(item => {
        csv += `"${item.activity}","${item.date}","${item.status}","${item.rating}","${item.type}","${item.location}","${item.duration}"\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', 'cultural_experiences_report.csv');
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Voice command functions
    function openVoiceModal() {
      document.getElementById('voice-modal').style.display = 'flex';
    }

    function closeVoiceModal() {
      document.getElementById('voice-modal').style.display = 'none';
      stopVoiceRecognition();
    }

    let recognition;
    function toggleVoiceRecognition() {
      if (!recognition || !recognition.isListening) {
        startVoiceRecognition();
      } else {
        stopVoiceRecognition();
      }
    }

    function startVoiceRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      
      if (!SpeechRecognition) {
        document.getElementById('voice-feedback').textContent = 
          'Speech recognition not supported in this browser. Try Chrome or Edge.';
        return;
      }
      
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      
      recognition.onstart = function() {
        document.getElementById('modal-voice-btn').classList.add('listening');
        document.getElementById('voice-feedback').textContent = 'Listening... Speak now!';
      };
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.toLowerCase();
        document.getElementById('voice-feedback').textContent = `You said: "${transcript}"`;
        processVoiceCommand(transcript);
      };
      
      recognition.onerror = function(event) {
        document.getElementById('voice-feedback').textContent = 
          `Error occurred: ${event.error}`;
        document.getElementById('modal-voice-btn').classList.remove('listening');
      };
      
      recognition.onend = function() {
        document.getElementById('modal-voice-btn').classList.remove('listening');
      };
      
      recognition.start();
    }

    function stopVoiceRecognition() {
      if (recognition) {
        recognition.stop();
      }
    }

    function processVoiceCommand(command) {
      const feedback = document.getElementById('voice-feedback');
      
      if (command.includes('bookings') || command.includes('my bookings')) {
        feedback.textContent += '\nOpening your bookings...';
        setTimeout(() => viewBookings(), 1000);
      } 
      else if (command.includes('report') || command.includes('generate report')) {
        feedback.textContent += '\nOpening report generator...';
        setTimeout(() => {
          closeVoiceModal();
          openReportDialog();
        }, 1000);
      }
      else if (command.includes('search for') && command.split('search for').length > 1) {
        const searchTerm = command.split('search for')[1].trim();
        feedback.textContent += `\nSearching for "${searchTerm}"...`;
        document.getElementById('dashboard-search').value = searchTerm;
        setTimeout(() => searchDashboard(), 1000);
      }
      else if (command.includes('profile') || command.includes('view profile')) {
        feedback.textContent += '\nOpening your profile...';
        setTimeout(() => window.location.href = '/profile', 1000);
      }
      else if (command.includes('log out') || command.includes('sign out')) {
        feedback.textContent += '\nLogging out...';
        setTimeout(() => document.getElementById('logout-link').click(), 1000);
      }
      else if (command.includes('help')) {
        feedback.textContent += '\nAvailable commands:\n- Show my bookings\n- Generate report\n- Search for [text]\n- View profile\n- Log out';
      }
      else {
        feedback.textContent += '\nCommand not recognized. Try saying "help" for available commands.';
      }
    }

    // Navigation functions
    function viewBookings() {
      // In a real app, this would redirect to the bookings page
      alert('Redirecting to bookings page...');
      // window.location.href = '/bookings';
    }

    function viewRecentTasks() {
      // In a real app, this would show recent activities
      alert('Showing recent activities...');
    }

    function contactSupport() {
      // In a real app, this would open a support form
      alert('Opening support contact form...');
    }
  </script>
</body>
</html>